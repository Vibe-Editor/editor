{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/utils/authToken.ts"],"sourcesContent":["export const AUTH_TOKEN_KEY = \"authToken\";\n\nexport function getAuthToken(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return localStorage.getItem(AUTH_TOKEN_KEY);\n}\n\nexport function setAuthToken(token: string) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(AUTH_TOKEN_KEY, token);\n}\n\nexport function clearAuthToken() {\n  if (typeof window === \"undefined\") return;\n  localStorage.removeItem(AUTH_TOKEN_KEY);\n  localStorage.removeItem(\"authUser\");\n}\n\nexport function setAuthUser(user: unknown) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(\"authUser\", JSON.stringify(user));\n}\n\nexport function getAuthUser(): unknown | null {\n  if (typeof window === \"undefined\") return null;\n  const val = localStorage.getItem(\"authUser\");\n  return val ? JSON.parse(val) : null;\n}\n"],"names":[],"mappings":";;;;;;;;AAAO,MAAM,iBAAiB;AAEvB,SAAS;IACd;;IACA,OAAO,aAAa,OAAO,CAAC;AAC9B;AAEO,SAAS,aAAa,KAAa;IACxC;;IACA,aAAa,OAAO,CAAC,gBAAgB;AACvC;AAEO,SAAS;IACd;;IACA,aAAa,UAAU,CAAC;IACxB,aAAa,UAAU,CAAC;AAC1B;AAEO,SAAS,YAAY,IAAa;IACvC;;IACA,aAAa,OAAO,CAAC,YAAY,KAAK,SAAS,CAAC;AAClD;AAEO,SAAS;IACd;;IACA,MAAM,MAAM,aAAa,OAAO,CAAC;IACjC,OAAO,MAAM,KAAK,KAAK,CAAC,OAAO;AACjC","debugId":null}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/lib/axiosInstance.ts"],"sourcesContent":["import axios from \"axios\";\nimport { getAuthToken, clearAuthToken } from \"../utils/authToken\";\n\nexport const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || \"https://backend.usuals.ai\";\n\nexport const axiosInstance = axios.create({\n  baseURL: API_BASE_URL,\n  withCredentials: true,\n});\n\n// Attach token on every request ------------------------------------------------\naxiosInstance.interceptors.request.use((config) => {\n  const token = getAuthToken();\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Wipe credentials & force re-login on 401 -------------------------------------\naxiosInstance.interceptors.response.use(\n  (res) => res,\n  (err) => {\n    if (err?.response?.status === 401) {\n      // Clear stored credentials so that AuthProvider shows the login screen\n      if (typeof window !== \"undefined\") {\n        clearAuthToken();\n        window.location.href = \"/\";\n      }\n    }\n    return Promise.reject(err);\n  }\n);\n"],"names":[],"mappings":";;;;AAG4B;AAH5B;AACA;;;AAEO,MAAM,eAAe,gKAAA,CAAA,UAAO,CAAC,GAAG,CAAC,wBAAwB,IAAI;AAE7D,MAAM,gBAAgB,wIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IACxC,SAAS;IACT,iBAAiB;AACnB;AAEA,iFAAiF;AACjF,cAAc,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IACtC,MAAM,QAAQ,CAAA,GAAA,4HAAA,CAAA,eAAY,AAAD;IACzB,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,aAAa,GAAG,AAAC,UAAe,OAAN;IAC3C;IACA,OAAO;AACT;AAEA,iFAAiF;AACjF,cAAc,YAAY,CAAC,QAAQ,CAAC,GAAG,CACrC,CAAC,MAAQ,KACT,CAAC;QACK;IAAJ,IAAI,CAAA,gBAAA,2BAAA,gBAAA,IAAK,QAAQ,cAAb,oCAAA,cAAe,MAAM,MAAK,KAAK;QACjC,uEAAuE;QACvE,wCAAmC;YACjC,CAAA,GAAA,4HAAA,CAAA,iBAAc,AAAD;YACb,OAAO,QAAQ,CAAC,IAAI,GAAG;QACzB;IACF;IACA,OAAO,QAAQ,MAAM,CAAC;AACxB","debugId":null}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/lib/endpoints.ts"],"sourcesContent":["import { API_BASE_URL } from \"./axiosInstance\";\n\nexport const ENDPOINTS = {\n  GOOGLE_OAUTH: `${API_BASE_URL}/auth/google`,\n  BACKEND_GOOGLE_REDIRECT: `${API_BASE_URL}/auth/google-redirect`,\n  TOKEN_STATUS: `${API_BASE_URL}/auth/status`,\n};\n"],"names":[],"mappings":";;;AAAA;;AAEO,MAAM,YAAY;IACvB,cAAc,AAAC,GAAe,OAAb,8HAAA,CAAA,eAAY,EAAC;IAC9B,yBAAyB,AAAC,GAAe,OAAb,8HAAA,CAAA,eAAY,EAAC;IACzC,cAAc,AAAC,GAAe,OAAb,8HAAA,CAAA,eAAY,EAAC;AAChC","debugId":null}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/context/AuthContext.tsx"],"sourcesContent":["\"use client\";\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport { getAuthToken, setAuthToken, setAuthUser, clearAuthToken } from \"../utils/authToken\";\nimport { ENDPOINTS } from \"../lib/endpoints\";\nimport { axiosInstance } from \"../lib/axiosInstance\";\n\nimport { AxiosInstance } from \"axios\";\n\ninterface AuthContextValue {\n  isAuthenticated: boolean;\n  token: string | null;\n  user: unknown | null;\n  api: AxiosInstance;\n  login: () => void;\n  logout: () => void;\n}\n\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined);\n\nexport function useAuth() {\n  const ctx = useContext(AuthContext);\n  if (!ctx) throw new Error(\"AuthContext not found\");\n  return ctx;\n}\n\ninterface Props {\n  children: React.ReactNode;\n}\n\nexport function AuthProvider({ children }: Props) {\n  const [token, setToken] = useState<string | null>(null);\n  const [user, setUser] = useState<unknown | null>(() => {\n    if (typeof window === \"undefined\") return null;\n    try {\n      const stored = localStorage.getItem(\"authUser\");\n      return stored ? JSON.parse(stored) : null;\n    } catch {\n      return null;\n    }\n  });\n\n  // Persist user whenever it changes\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    if (user) {\n      try {\n        localStorage.setItem(\"authUser\", JSON.stringify(user));\n      } catch {}\n    } else {\n      localStorage.removeItem(\"authUser\");\n    }\n  }, [user]);\n\n  // Axios instance is already configured globally with getAuthToken()\n  const api = axiosInstance;\n\n  useEffect(() => {\n    // 1️⃣ Check URL for ?token & ?user delivered by backend (browser flow)\n    if (typeof window !== \"undefined\") {\n      const p = new URLSearchParams(window.location.search);\n      const urlToken = p.get(\"token\");\n      if (urlToken) {\n        setAuthToken(urlToken);\n        setToken(urlToken);\n        const userParam = p.get(\"user\");\n        if (userParam) {\n          try {\n            const userObj = JSON.parse(decodeURIComponent(userParam));\n            setAuthUser(userObj);\n            setUser(userObj);\n          } catch {\n            // ignore parse errors\n          }\n        }\n        // clean query string\n        window.history.replaceState({}, \"\", window.location.pathname);\n        return;\n      }\n    }\n\n    const existing = getAuthToken();\n    if (existing) {\n      setToken(existing);\n      return;\n    }\n    // 2️⃣ If no token in localStorage, check session cookie via status endpoint\n    (async () => {\n      try {\n        const res = await fetch(ENDPOINTS.TOKEN_STATUS, {\n          credentials: \"include\",\n        });\n        if (res.ok) {\n          // backend says session valid; store placeholder token\n          setToken(\"session\");\n        }\n      } catch (err) {\n        console.warn(\"Auth status check failed\", err);\n      }\n    })();\n  }, []);\n\n  const login = () => {\n    const redirectUri = `${window.location.origin}/oauth-cb`;\n    window.location.href = `${ENDPOINTS.GOOGLE_OAUTH}?redirect_uri=${encodeURIComponent(redirectUri)}`;\n  };\n  const logout = () => {\n    clearAuthToken();\n    setToken(null);\n    setUser(null);\n  };\n\n  const value: AuthContextValue = {\n    isAuthenticated: !!token && !!user,\n    token,\n    user,\n    api,\n    login,\n    logout,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!token ? (\n        <div className=\"flex items-center justify-center min-h-screen bg-gray-100 p-4\">\n          <button\n            onClick={login}\n            className=\"px-6 py-3 bg-emerald-600 text-white rounded\"\n          >\n            Sign in with Google\n          </button>\n        </div>\n      ) : (\n        children\n      )}\n    </AuthContext.Provider>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;AAJA;;;;;AAiBA,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,gBAAa,AAAD,EAAgC;AAEzD,SAAS;;IACd,MAAM,MAAM,CAAA,GAAA,6JAAA,CAAA,aAAU,AAAD,EAAE;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;GAJgB;AAUT,SAAS,aAAa,KAAmB;QAAnB,EAAE,QAAQ,EAAS,GAAnB;;IAC3B,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD;iCAAkB;YAC/C;;YACA,IAAI;gBACF,MAAM,SAAS,aAAa,OAAO,CAAC;gBACpC,OAAO,SAAS,KAAK,KAAK,CAAC,UAAU;YACvC,EAAE,UAAM;gBACN,OAAO;YACT;QACF;;IAEA,mCAAmC;IACnC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR;;YACA,IAAI,MAAM;gBACR,IAAI;oBACF,aAAa,OAAO,CAAC,YAAY,KAAK,SAAS,CAAC;gBAClD,EAAE,UAAM,CAAC;YACX,OAAO;gBACL,aAAa,UAAU,CAAC;YAC1B;QACF;iCAAG;QAAC;KAAK;IAET,oEAAoE;IACpE,MAAM,MAAM,8HAAA,CAAA,gBAAa;IAEzB,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR,uEAAuE;YACvE,wCAAmC;gBACjC,MAAM,IAAI,IAAI,gBAAgB,OAAO,QAAQ,CAAC,MAAM;gBACpD,MAAM,WAAW,EAAE,GAAG,CAAC;gBACvB,IAAI,UAAU;oBACZ,CAAA,GAAA,4HAAA,CAAA,eAAY,AAAD,EAAE;oBACb,SAAS;oBACT,MAAM,YAAY,EAAE,GAAG,CAAC;oBACxB,IAAI,WAAW;wBACb,IAAI;4BACF,MAAM,UAAU,KAAK,KAAK,CAAC,mBAAmB;4BAC9C,CAAA,GAAA,4HAAA,CAAA,cAAW,AAAD,EAAE;4BACZ,QAAQ;wBACV,EAAE,UAAM;wBACN,sBAAsB;wBACxB;oBACF;oBACA,qBAAqB;oBACrB,OAAO,OAAO,CAAC,YAAY,CAAC,CAAC,GAAG,IAAI,OAAO,QAAQ,CAAC,QAAQ;oBAC5D;gBACF;YACF;YAEA,MAAM,WAAW,CAAA,GAAA,4HAAA,CAAA,eAAY,AAAD;YAC5B,IAAI,UAAU;gBACZ,SAAS;gBACT;YACF;YACA,4EAA4E;YAC5E;0CAAC;oBACC,IAAI;wBACF,MAAM,MAAM,MAAM,MAAM,0HAAA,CAAA,YAAS,CAAC,YAAY,EAAE;4BAC9C,aAAa;wBACf;wBACA,IAAI,IAAI,EAAE,EAAE;4BACV,sDAAsD;4BACtD,SAAS;wBACX;oBACF,EAAE,OAAO,KAAK;wBACZ,QAAQ,IAAI,CAAC,4BAA4B;oBAC3C;gBACF;aAAC;QACH;iCAAG,EAAE;IAEL,MAAM,QAAQ;QACZ,MAAM,cAAc,AAAC,GAAyB,OAAvB,OAAO,QAAQ,CAAC,MAAM,EAAC;QAC9C,OAAO,QAAQ,CAAC,IAAI,GAAG,AAAC,GAAyC,OAAvC,0HAAA,CAAA,YAAS,CAAC,YAAY,EAAC,kBAAgD,OAAhC,mBAAmB;IACtF;IACA,MAAM,SAAS;QACb,CAAA,GAAA,4HAAA,CAAA,iBAAc,AAAD;QACb,SAAS;QACT,QAAQ;IACV;IAEA,MAAM,QAA0B;QAC9B,iBAAiB,CAAC,CAAC,SAAS,CAAC,CAAC;QAC9B;QACA;QACA;QACA;QACA;IACF;IAEA,qBACE,6LAAC,YAAY,QAAQ;QAAC,OAAO;kBAC1B,CAAC,sBACA,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBACC,SAAS;gBACT,WAAU;0BACX;;;;;;;;;;mBAKH;;;;;;AAIR;IA3GgB;KAAA","debugId":null}}]
}