{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/utils/authToken.ts"],"sourcesContent":["export const AUTH_TOKEN_KEY = \"authToken\";\n\nexport function getAuthToken(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return localStorage.getItem(AUTH_TOKEN_KEY);\n}\n\nexport function setAuthToken(token: string) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(AUTH_TOKEN_KEY, token);\n}\n\nexport function clearAuthToken() {\n  if (typeof window === \"undefined\") return;\n  localStorage.removeItem(AUTH_TOKEN_KEY);\n  localStorage.removeItem(\"authUser\");\n}\n\nexport function setAuthUser(user: unknown) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(\"authUser\", JSON.stringify(user));\n}\n\nexport function getAuthUser(): unknown | null {\n  if (typeof window === \"undefined\") return null;\n  const val = localStorage.getItem(\"authUser\");\n  return val ? JSON.parse(val) : null;\n}\n"],"names":[],"mappings":";;;;;;;;AAAO,MAAM,iBAAiB;AAEvB,SAAS;IACd,wCAAmC,OAAO;;;AAE5C;AAEO,SAAS,aAAa,KAAa;IACxC,wCAAmC;;;AAErC;AAEO,SAAS;IACd,wCAAmC;;;AAGrC;AAEO,SAAS,YAAY,IAAa;IACvC,wCAAmC;;;AAErC;AAEO,SAAS;IACd,wCAAmC,OAAO;;;IAC1C,MAAM;AAER","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/lib/axiosInstance.ts"],"sourcesContent":["import axios from \"axios\";\nimport { getAuthToken, clearAuthToken } from \"../utils/authToken\";\n\nexport const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || \"https://backend.usuals.ai\";\n\nexport const axiosInstance = axios.create({\n  baseURL: API_BASE_URL,\n  withCredentials: true,\n});\n\n// Attach token on every request ------------------------------------------------\naxiosInstance.interceptors.request.use((config) => {\n  const token = getAuthToken();\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Wipe credentials & force re-login on 401 -------------------------------------\naxiosInstance.interceptors.response.use(\n  (res) => res,\n  (err) => {\n    if (err?.response?.status === 401) {\n      // Clear stored credentials so that AuthProvider shows the login screen\n      if (typeof window !== \"undefined\") {\n        clearAuthToken();\n        window.location.href = \"/\";\n      }\n    }\n    return Promise.reject(err);\n  }\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,MAAM,eAAe,QAAQ,GAAG,CAAC,wBAAwB,IAAI;AAE7D,MAAM,gBAAgB,qIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IACxC,SAAS;IACT,iBAAiB;AACnB;AAEA,iFAAiF;AACjF,cAAc,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IACtC,MAAM,QAAQ,CAAA,GAAA,yHAAA,CAAA,eAAY,AAAD;IACzB,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IAClD;IACA,OAAO;AACT;AAEA,iFAAiF;AACjF,cAAc,YAAY,CAAC,QAAQ,CAAC,GAAG,CACrC,CAAC,MAAQ,KACT,CAAC;IACC,IAAI,KAAK,UAAU,WAAW,KAAK;QACjC,uEAAuE;QACvE;;IAIF;IACA,OAAO,QAAQ,MAAM,CAAC;AACxB","debugId":null}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/lib/endpoints.ts"],"sourcesContent":["import { API_BASE_URL } from \"./axiosInstance\";\n\nexport const ENDPOINTS = {\n  GOOGLE_OAUTH: `${API_BASE_URL}/auth/google`,\n  BACKEND_GOOGLE_REDIRECT: `${API_BASE_URL}/auth/google-redirect`,\n  TOKEN_STATUS: `${API_BASE_URL}/auth/status`,\n};\n"],"names":[],"mappings":";;;AAAA;;AAEO,MAAM,YAAY;IACvB,cAAc,GAAG,2HAAA,CAAA,eAAY,CAAC,YAAY,CAAC;IAC3C,yBAAyB,GAAG,2HAAA,CAAA,eAAY,CAAC,qBAAqB,CAAC;IAC/D,cAAc,GAAG,2HAAA,CAAA,eAAY,CAAC,YAAY,CAAC;AAC7C","debugId":null}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///Users/naval/Desktop/usuals.ai/editor/testing-frontend%2016.49.16%202/usuals.ai/app/context/AuthContext.tsx"],"sourcesContent":["\"use client\";\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport { getAuthToken, setAuthToken, setAuthUser, clearAuthToken } from \"../utils/authToken\";\nimport { ENDPOINTS } from \"../lib/endpoints\";\nimport { axiosInstance } from \"../lib/axiosInstance\";\n\nimport { AxiosInstance } from \"axios\";\n\ninterface AuthContextValue {\n  isAuthenticated: boolean;\n  token: string | null;\n  user: unknown | null;\n  api: AxiosInstance;\n  login: () => void;\n  logout: () => void;\n}\n\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined);\n\nexport function useAuth() {\n  const ctx = useContext(AuthContext);\n  if (!ctx) throw new Error(\"AuthContext not found\");\n  return ctx;\n}\n\ninterface Props {\n  children: React.ReactNode;\n}\n\nexport function AuthProvider({ children }: Props) {\n  const [token, setToken] = useState<string | null>(null);\n  const [user, setUser] = useState<unknown | null>(() => {\n    if (typeof window === \"undefined\") return null;\n    try {\n      const stored = localStorage.getItem(\"authUser\");\n      return stored ? JSON.parse(stored) : null;\n    } catch {\n      return null;\n    }\n  });\n\n  // Persist user whenever it changes\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    if (user) {\n      try {\n        localStorage.setItem(\"authUser\", JSON.stringify(user));\n      } catch {}\n    } else {\n      localStorage.removeItem(\"authUser\");\n    }\n  }, [user]);\n\n  // Axios instance is already configured globally with getAuthToken()\n  const api = axiosInstance;\n\n  useEffect(() => {\n    // 1️⃣ Check URL for ?token & ?user delivered by backend (browser flow)\n    if (typeof window !== \"undefined\") {\n      const p = new URLSearchParams(window.location.search);\n      const urlToken = p.get(\"token\");\n      if (urlToken) {\n        setAuthToken(urlToken);\n        setToken(urlToken);\n        const userParam = p.get(\"user\");\n        if (userParam) {\n          try {\n            const userObj = JSON.parse(decodeURIComponent(userParam));\n            setAuthUser(userObj);\n            setUser(userObj);\n          } catch {\n            // ignore parse errors\n          }\n        }\n        // clean query string\n        window.history.replaceState({}, \"\", window.location.pathname);\n        return;\n      }\n    }\n\n    const existing = getAuthToken();\n    if (existing) {\n      setToken(existing);\n      return;\n    }\n    // 2️⃣ If no token in localStorage, check session cookie via status endpoint\n    (async () => {\n      try {\n        const res = await fetch(ENDPOINTS.TOKEN_STATUS, {\n          credentials: \"include\",\n        });\n        if (res.ok) {\n          // backend says session valid; store placeholder token\n          setToken(\"session\");\n        }\n      } catch (err) {\n        console.warn(\"Auth status check failed\", err);\n      }\n    })();\n  }, []);\n\n  const login = () => {\n    const redirectUri = `${window.location.origin}/oauth-cb`;\n    window.location.href = `${ENDPOINTS.GOOGLE_OAUTH}?redirect_uri=${encodeURIComponent(redirectUri)}`;\n  };\n  const logout = () => {\n    clearAuthToken();\n    setToken(null);\n    setUser(null);\n  };\n\n  const value: AuthContextValue = {\n    isAuthenticated: !!token && !!user,\n    token,\n    user,\n    api,\n    login,\n    logout,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!token ? (\n        <div className=\"flex items-center justify-center min-h-screen bg-gray-100 p-4\">\n          <button\n            onClick={login}\n            className=\"px-6 py-3 bg-emerald-600 text-white rounded\"\n          >\n            Sign in with Google\n          </button>\n        </div>\n      ) : (\n        children\n      )}\n    </AuthContext.Provider>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AAJA;;;;;;AAiBA,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,gBAAa,AAAD,EAAgC;AAEzD,SAAS;IACd,MAAM,MAAM,CAAA,GAAA,qMAAA,CAAA,aAAU,AAAD,EAAE;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;AAMO,SAAS,aAAa,EAAE,QAAQ,EAAS;IAC9C,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAkB;QAC/C,wCAAmC,OAAO;;;IAO5C;IAEA,mCAAmC;IACnC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,wCAAmC;;;IAQrC,GAAG;QAAC;KAAK;IAET,oEAAoE;IACpE,MAAM,MAAM,2HAAA,CAAA,gBAAa;IAEzB,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,uEAAuE;QACvE;;QAsBA,MAAM,WAAW,CAAA,GAAA,yHAAA,CAAA,eAAY,AAAD;QAC5B,IAAI,UAAU;YACZ,SAAS;YACT;QACF;QACA,4EAA4E;QAC5E,CAAC;YACC,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM,uHAAA,CAAA,YAAS,CAAC,YAAY,EAAE;oBAC9C,aAAa;gBACf;gBACA,IAAI,IAAI,EAAE,EAAE;oBACV,sDAAsD;oBACtD,SAAS;gBACX;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,4BAA4B;YAC3C;QACF,CAAC;IACH,GAAG,EAAE;IAEL,MAAM,QAAQ;QACZ,MAAM,cAAc,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC;QACxD,OAAO,QAAQ,CAAC,IAAI,GAAG,GAAG,uHAAA,CAAA,YAAS,CAAC,YAAY,CAAC,cAAc,EAAE,mBAAmB,cAAc;IACpG;IACA,MAAM,SAAS;QACb,CAAA,GAAA,yHAAA,CAAA,iBAAc,AAAD;QACb,SAAS;QACT,QAAQ;IACV;IAEA,MAAM,QAA0B;QAC9B,iBAAiB,CAAC,CAAC,SAAS,CAAC,CAAC;QAC9B;QACA;QACA;QACA;QACA;IACF;IAEA,qBACE,8OAAC,YAAY,QAAQ;QAAC,OAAO;kBAC1B,CAAC,sBACA,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBACC,SAAS;gBACT,WAAU;0BACX;;;;;;;;;;mBAKH;;;;;;AAIR","debugId":null}}]
}